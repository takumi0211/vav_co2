# TODO 躯体蓄熱を用いて低炭素制御

今のVAVは26度一定で8時から18時まで保つように制御しています。しかし、躯体蓄熱を考慮してCO2排出係数に基づいたCO2排出量の最小化制御を実装したいと考えています。
- LLMとRLを制御エージェントとして「設定室温度のみ」を決めさせます。その他（damper valveなど）はルールベースで行います。（ハイエンド制御）
  - アクション間隔は30分08:00-17:30
  - simulator_humid/agents/llm_agent.py、simulator_humid/agents/ollama_agent.py、simulator_humid/agents/rlを編集してください。
- weather_data/co2/dynamic_co2_factor_20250619.csvが動的CO2係数です。
  - 動的CO2排出係数は30分間一定とします
  - 消費電力と同時にCO2排出量を算出するようにしてください。（30分なのに注意）
- weather_data/outdoor_temp_20250619.csvが天気データです。
- 快適温度域は23.5度から26.5度とします
  - 但し、午前中の設定温度は
- 評価関数は快適性（今の継続）とCO2排出量（消費電力でなく）でお願いします。
- 状態空間（およびプロンプトに入れる変数）
  - 現在の時刻（1〜20）/20（正規化）
  - 外気温 /40（正規化）
  - 外気温2step間隔での予測（6時間先まで）/40（正規化）
  - 動的CO2係数　/0.5（正規化）
  - 動的CO2係数の2step間隔での予測（6時間先まで）/0.5（正規化）
  - 各ゾーン
    - 室温（うまく正規化）
    - 設定温度との差分（うまく正規化）
    - 過去の設定温度4step分（うまく正規化）
- 行動空間
  - 各ゾーン
    - 設定温度0.5度刻みで23.5-26まで
      - 但し環境側で全てのゾーンで設定温度>ゾーン温度の場合、コイル（冷却/加熱）だけオフにし、ファン・外気ダンパーは最低換気量を維持するルールにする。（CO2濃度のPI制御）
      - つまり、ファン周波数に最小値を設ける
    - あくまでもRLやLLMは設定温度のみしか考えず、CO2は考えない
- 報酬設計
  - 快適範囲からの逸脱（23.5-26）2乗でダメージ
    - 但し、これは作用温度とすること（MRT+Air temp /2）
    - 作用温度はRLとLLMに与えない（過去の設定温度4step分から暗に学習することを狙う）
  - また、1.5度/30分、2.5度/1時間の温度変化には罰を与えるように
    - λ_ramp × max(0, |ΔT| − 閾値)²とか
  - –総CO2排出量（排出係数*消費電力*時間）

その他
- plotは基本的に今のままでいいが、CO2排出係数の変遷と消費電力の重ね合わせのグラフを下に追加してほしい。
- ログのcsv出力も今のをベースとして色々追加して
- 総消費電力量も総CO2排出量と同様に算出すること
- 給気温度の設定値は各ゾーンの設定温度の平均値-10度とすること
  - 全zone25度→15度
  - それは今同様バルブPI制御

